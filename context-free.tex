
\chapter{Контекстно-свободни езици}

\section{Свойства}

Някои свойства на контекстно-свободните езици:
\begin{itemize}
\item 
  те са затворени относно операцията обединение, т.е.
  ако $L_1, L_2$ са контекстно-свободни, то езикът $L_1 \cup L_2$ е контекстно-свободен; 
\item
  те са затворени относно операцията конкатенация, т.е.
  ако $L_1, L_2$ са контекстно-свободни, то езикът $L_1 \cdot L_2$ е контекстно-свободен; 
\item
  те са затворени относно операцията звезда на Клини, т.е.
  ако $L$ е контекстно-свободен, то езикът $L^\star = \bigcup_{n\in\Nat} L^n$ е контекстно-свободен; 
\item
  те {\bf не} са затворени относно операцията сечение, т.е.
  съществуват контекстно-свободни езици $L_1, L_2$, за които езикът $L_1 \cap L_2$ {\bf не} е контекстно-свободен; 
\item
  те са затворени относно сечение с регулярен език, т.е.
  ако $L$ е контекстно-свободен език и $R$ е регулярен език, то езикът $L = L \cap R$ е контекстно-свободен; 
\item
  те {\bf не} са затворени относно операцията допълнение, т.е.
  съществува контекстно-свободен език $L$, за който езикът $\Sigma^\star\setminus L$ {\bf не} е контекстно-свободен; 
% \item
%   те са затворени относно хомоморфизми, т.е.
%   ако $L \subseteq \Sigma^\star_1$ е контекстно-свободен език и $h:\Sigma_1\to\Sigma^\star_2$ е хомоморфизъм, 
%   то езикът $h(L) = \{h(\alpha) \in \Sigma^\star_2 \mid \alpha \in L\}$
%   е контекстно-свободен.
% \item
%   те са затворени относно обратни хомоморфизми, т.е.
%   ако $L\subseteq \Sigma^\star_2$ е контекстно-свободен език и $h:\Sigma_1\to\Sigma^\star_2$ е хомоморфизъм, 
%   то езикът $h^{-1}(L) = \{\alpha \in \Sigma^\star_1 \mid h(\alpha) \in L\}$
%   е контекстно-свободен.
\end{itemize}

\section{Контекстно-свободни граматики}
% От Сипсер, същото е в слайдовете на Сашка
% Малко е тъпо, че в Пападимитриу дефиницията е различна. Там \Sigma \subseteq V
\begin{dfn}
  \marginpar{На англ. context-free grammar}
  Контекстно-свободна граматика e четворка \[G = (V,\Sigma,R,S),\]
  където
  \begin{itemize}
  \item
    \marginpar{Променливите се наричат също нетерминали}
    $V$ е крайно множество от {\em променливи};
  \item
    \marginpar{Буквите се наричат също терминали.}
    $\Sigma$ е крайно множество от {\em букви}, $\Sigma \cap V = \emptyset$;
  \item
    $R \subseteq V\times (V\cup\Sigma)^\star$, крайно множество от {\em правила};
  \item
    $S \in V$ е началната променлива. 
  \end{itemize}
  Обикновено ще пишем $A \rightarrow_G v$ вместо $(A,v) \in R$.
  Пишем $u \Rightarrow_G v$, ако съществуват думи $x,y\in (\Sigma\cup V)^\star$, $A\in V$,
  правило $A\rightarrow_G v^\prime$ и $u = xAy$, $v = xv^\prime y$.
  Езикът генериран от $G$ е множеството
  \[L(G) = \{\alpha\in\Sigma^\star\mid S \rightarrow^\star_G \alpha\}.\]
\end{dfn}

\begin{problem}
  Да се докаже, че езикът $L = \{\alpha \in \{a,b\}^\star\mid n_a(\alpha) = n_b(\alpha)\}$ 
  е контекстно свободен.
\end{problem}
\begin{proof}
  \marginpar{  Алтернативна граматика за езика $L$ е
  \begin{align*}
    S& \rightarrow aB\vert bA\\
    A& \rightarrow a\vert aS\vert bAA\\
    B& \rightarrow b\vert bS\vert aBB
  \end{align*}}
  Една възможна граматика $G$ е следната: 
  \[S \rightarrow aSbS\vert bSaS \vert\varepsilon.\]
  За да докажете, че тя генерира $L$ трябва първо да видим, че:
  \begin{enumerate}[a)]
  \item 
    ако $n_a(\omega) = n_b(\omega) + 1$, то
    $\omega = \omega_1 a \omega_2$ и $n_a(\omega_1) = n_b(\omega_2)$.
  \item
    ако $n_b(\omega) = n_a(\omega) + 1$, то
    $\omega = \omega_1 b \omega_2$ и $n_a(\omega_1) = n_b(\omega_2)$.
  \end{enumerate}
  Тогава като следствие може да се изведе, че за думи $\omega$, за които $n_a(\omega) = n_b(\omega)$,
  е изпълнено:
  \begin{enumerate}[a)]
  \item 
    ако $\omega = a\omega^\prime$, то
    $\omega = a\omega_1b\omega_2$ и $n_a(\omega_1) = n_b(\omega_1)$, $n_a(\omega_2) = n_b(\omega_2)$;
  \item
    ако $\omega = b\omega^\prime$, то
    $\omega = b\omega_1a\omega_2$ и $n_a(\omega_1) = n_b(\omega_1)$, $n_a(\omega_2) = n_b(\omega_2)$.
  \end{enumerate}

  Сега първо ще проверим, че $L \subseteq L(G)$.
  За целта ще докажем с пълна индукция по дължината на думата $\omega$, че за всяка дума $\omega$ със свойството $n_a(\omega) = n_b(\omega)$ е изпълнено
  $S \rightarrow^\star \omega$.
  \begin{itemize}
  \item 
    $\abs{\omega} = 0$. $S \rightarrow \varepsilon$.
  \item
    $\abs{\omega} = k+1$. Тогава имаме два случая.
    \begin{itemize}
    \item 
      $\omega = a\omega^\prime$, т.е. $\omega = a\omega_1b\omega_2$ и $n_a(\omega_1) = n_b(\omega_1)$, $n_a(\omega_2) = n_b(\omega_2)$.
      Тогава $\abs{\omega_1} \leq k$ и по И.П. $S \rightarrow^\star \omega_1$.
      Аналогично, $S \rightarrow^\star \omega_2$.
      Понеже имаме правило $S \rightarrow aSbS$, заключаваме че $S \rightarrow^\star a\omega_1b\omega_2$.
    \item
      $\omega = b\omega^\prime$, т.е. $\omega = b\omega_1a\omega_2$ и $n_a(\omega_1) = n_b(\omega_1)$, $n_a(\omega_2) = n_b(\omega_2)$.
      Този случай се разглежда подобно на горния.
    \end{itemize}
  \end{itemize}
  
  Преминаваме към доказателството на другата посока, т.е. $L(G) \subseteq L$.
  Тук с пълна индукция по дължината на извода $l$ ще докажем, че
  $S \stackrel{\leq l}{\rightarrow} \omega$, то $\omega \in M$,
  където
  \[M = \{\omega \in \{a,b,S\}^\star \mid n_a(\omega) = n_b(\omega)\}.\]
  За $l = 0$  е ясно, че $S \stackrel{\leq 0}{\rightarrow^\star} S$.
  За $l = k+1$, то $S \stackrel{\leq k}{\rightarrow^\star} \alpha \rightarrow \omega$.
  От И.П. имаме, че $\alpha \in M$.
  Нека $\omega$ се получава от $\alpha$ с прилагане на правилото $C \rightarrow \gamma$.
  Разглеждаме всички варианти за думата $\alpha \in M$ и за правилото $C\rightarrow \gamma$ в граматиката $G$
  за да докажем, че  $\omega \in M$.
  Удобно е да представим всички случаи в таблица.
  \begin{center}
    \begin{tabular}{| c | c | c |}
      \hline
      $\alpha$ & $C \rightarrow \gamma$ & $\omega$ \\ \hline
      $\in M$ & $S \rightarrow aSbS$ & $\in M$ \\ \hline
      $\in M$ & $S \rightarrow bSaS$ & $\in M$ \\ \hline
      $\in M$ & $S \rightarrow \varepsilon$ & $\in M$ \\ \hline
    \end{tabular}
  \end{center}
  Във всички случаи лесно се установява, че $\omega \in M$.
  Така за всяка дума $\omega \in L(G)$ следва, че
  \[\omega \in \Sigma^\star \cap M = L.\]
\end{proof}

\begin{prb}
  Докажете, че езикът $L = \{a^mb^nc^k\mid m+n \geq k\}$ е
  контекстно-свободен.
\end{prb}
\begin{proof}
  Да разгледаме граматиката $G$ с правила
  \begin{align*}
    S& \rightarrow aSc\vert aS \vert B\\
    B& \rightarrow bBc\vert bB\vert\varepsilon.
  \end{align*}
  
  Лесно се вижда, че за всяко $n$ имаме свойствата:
  \begin{itemize}
  \item 
    $S \rightarrow^\star a^nSc^n$,
  \item
    $S \rightarrow^\star a^nS$,
  \item
    $B \rightarrow^\star a^nBc^n$,
  \item
    $B \rightarrow^\star b^nB$.
  \end{itemize}
  Сега можем да докажем, че за всеки $n \geq k$,
  \begin{itemize}
  \item 
    $S \rightarrow^\star a^nSc^k$,
  \item
    $B \rightarrow^\star b^nBc^k$.
  \end{itemize}
  За да докажем, че $L \subseteq L(G)$, 
  да разгледаме една дума $\omega \in L$, т.е. $\alpha = a^mb^nc^k$, $m+n \geq k$.
  Имаме два случая:
  \begin{itemize}
  \item 
    $k \leq m$, т.е. $m = k+l$ и $m+n = k+l+n$.
    Тогава имаме изводи
    \[S \rightarrow^\star a^kSc^k,\ S \rightarrow^\star a^lS,\ S \rightarrow B,\ B \rightarrow^\star b^nB,\ B \rightarrow \varepsilon.\]
    Обединявайки всичко това, получаваме:
    \[S \rightarrow^\star a^mb^nc^k.\]
  \item
    $k > m$, т.е. $k = m+l$ и $m+n = m+l+r$.
    Тогава имаме изводи
    \[S \rightarrow^\star a^mSc^m,\ S\rightarrow B,\ B\rightarrow^\star b^lBc^l,\ B\rightarrow b^rB,\ B\rightarrow\varepsilon,\]
    и отново получаваме $S \rightarrow^\star a^mb^nc^k$.
  \end{itemize}
  Така доказахме, че $\omega \in L(G)$.
  
  Сега ще докажем, че $L(G) \subseteq L$.
  С пълна индукция по дължината на извода $l$,
  ще докажем, че ако $S \stackrel{\leq l}{\rightarrow^\star}\omega$, то $\omega \in M$, където
  \[M = \{a^nSc^k\mid n\geq k\}\cup\{a^nb^mBc^k\mid n+m\geq k\}\cup\{a^nb^mc^k\mid n+m\geq k\}.\]
  
  Ако $l = 0$, то е ясно, че $S \stackrel{\leq 0}{\rightarrow^\star} S$, $S \in M$.

  Нека $l = k+1$ и $S \stackrel{\leq k}{\rightarrow^\star} \alpha \rightarrow \omega$.
  От И.П. имаме $\alpha \in M$. Нека $\omega$ се получава от $\alpha$ с прилагане на правилото $C \rightarrow \gamma$.
  Разглеждаме всички варианти за думата $\alpha \in M$ и за правилото $C\rightarrow \gamma$ в граматиката $G$
  за да докажем, че  $\omega \in M$.
  Удобно е да представим всички случаи в таблица.
  \begin{center}
    \begin{tabular}{| c | c | c |}
      \hline
      $\alpha$ & $C \rightarrow \gamma$ & $\omega$ \\ \hline
      $a^nSc^k$ & $S \rightarrow aSc$ & $a^{n+1}Sc^{k+1}$ \\ \hline
      $a^nSc^k$ & $S \rightarrow aS$ & $a^{n+1}Sc^{k}$ \\ \hline
      $a^nSc^k$ & $S \rightarrow B$ & $a^{n}Bc^{k}$ \\ \hline
      $a^nb^mBc^k$ & $B \rightarrow bBc$ & $a^nb^{m+1}Bc^{k+1}$\\ \hline
      $a^nb^mBc^k$ & $B \rightarrow bB$ & $a^nb^{m+1}Bc^{k}$\\ \hline
      $a^nb^mBc^k$ & $B \rightarrow \varepsilon$ & $a^nb^{m}c^{k}$\\ \hline
    \end{tabular}
  \end{center}
  Във всички случаи се установява, че $\omega \in M$.
  Сега, за всяка дума $\omega \in L(G)$ следва, че
  \[\omega \in \Sigma^\star \cap M = \{a^mb^nc^k\mid m+n \geq k\}.\]
\end{proof}

\begin{problem}
  Докажете, че следните езици са контекстно-свободни:
  \begin{enumerate}[1)]
  \item
    $L = \{ww^R \mid w \in \{a,b\}^\star\}$;
  \item
    $L = \{w \in \{a,b\}^\star \mid w = w^R\}$;
  \item
    $L = \{a^nb^{2n} \mid n \in \Nat\}$;
  \item
    $L = \{a^nb^k \mid n > k\}$;
  \item
    $L = \{a^nb^k \mid n \geq 2k\}$;
  \item
    $L = \{a^nb^mc^{n+m}\mid n,m \in \Nat\}$;
  \end{enumerate}
\end{problem}
% \begin{proof}
%   \begin{enumerate}[1)]
%   \item
%     Нека правилата на граматиката са 
%     \[S\ \rightarrow\ aSa\ \vert\ bSb\ \vert\ \varepsilon.\]
%   \item
%     Нека правилата на граматиката $G$ са 
%     \[S\ \rightarrow\ aSa\ \vert\ bSb\ \vert\ a\vert\ b\ \vert\ \varepsilon.\]
%     Ще докажем, че $L(G) = L$.
%     Докажете, че с индукция по дължината на думата, че за думи от вида $\omega = \omega^R$:
%     \begin{itemize}[-]
%     \item 
%       ако $\abs{\omega} = 2n$, то $\omega = \alpha\alpha^R$;
%     \item
%       ако $\abs{\omega} = 2n+1$, то $\omega = \beta a\beta^R$ или $\omega = \alpha b\alpha^R$.
%     \end{itemize}
%     След това, докажете, че:
%     \begin{enumerate}
%     \item 
%       за всяко $l$,
%       ако $S \stackrel{\leq l}{\Rightarrow} \omega$, то $\omega = \alpha S \alpha^R\ \vert\ \alpha a \alpha^R\ \vert\ \alpha b \alpha^R\ \vert \alpha\alpha^R$,
%       за някоя дума $\alpha$.
%     \item
%       за всяка дума $\omega$,
%       $S \Rightarrow^\star \omega S \omega^R$.
%     \end{enumerate}
    
%   \item
%   \item
%     $S\ \rightarrow\ aS\ \vert\ aSb\ \vert\ a$.
%   \item
%   \end{enumerate}

% \end{proof}


\section{Езици, които не са контекстно-свободни}

\begin{lemma}[за нарастването (контекстно-свободни езици)]
  \index{лема за нарастването!контекстно-свободни езици}
  \label{lem:pumping-context} 
  За всеки КСЕ $L\neq\{\epsilon\}$ съществува $p>0$ такова,
  че ако $\alpha\in L, \abs{\alpha} \geq p$, то $\alpha=xyuvw$ и
  \begin{enumerate}
  \item
    $\abs{yv}\geq 1$,
  \item
    $\abs{yuv}\leq p$, и
  \item
    $(\forall i\geq 0)[xy^iuv^iw\in L]$.
\end{enumerate}
\end{lemma}

\begin{crl}
  Нека $G$ е контекстно-свободна граматика и $p$ е константата за разрастването на $G$.
  Тогава $\abs{L(G)} = \infty$ точно тогава, когато съществува $z \in L(G)$, за която $p \leq \abs{z} \leq 2p$.
\end{crl}

\begin{problem}
  Да се даде пример за език $L$, който {\bf не} е контекстно-свободен, но удовлетворява
  лемата за разрастването.
\end{problem}

\begin{example}
  Приложете лемата за нарастването за да докажете, че 
  следните езици не са контекстно-свободни:
  \begin{itemize}
  \item
    $L_1 = \{a^ib^jc^k\ \mid\ 0 \leq i \leq j \leq k\}$;
  \item
    $L_2 = \{ww\mid w\in \{a,b\}^\star\}$;
  \end{itemize}
\end{example}
\begin{proof}
  \begin{enumerate}[1)]
  \item
    Разгледайте $w = a^pb^pc^p$.
    \begin{enumerate}[a)]
    \item
      Знаем, че поне една от $y$ и $v$ не е празната дума.
      Имаме три случая за поддумите $y$ и $v$.
      \begin{enumerate}[i)]
      \item
        $a$ не се среща в $y$ и $v$.
        Тогава $xy^0vu^0w$ съдържа повече $a$ от $b$ или $c$.
      \item
        $b$ не се среща в $y$ и $v$.
        Ако $a$ се среща в $y$ или $v$, тогава $xy^2uv^2w$ съдържа повече $a$ от $b$
        Ако $c$ се среща в $y$ или $v$, тогава $xy^0uv^0w$ съдържа по-малко $c$ от $b$.
      \item
        $c$ не се среща в $y$ и $v$.
        Тогава $xy^2uv^2w$ съдържа повече $a$ или $b$ от $c$.
      \end{enumerate}      
    \item
      $y$ или $v$ е съставена от две букви.  Контекстно-свободните езици {\bf не} са затворени относно сечение и допълнение.
      Тук разглеждаме $xy^2uv^2w$ и съобразяваме, че редът на буквите е нарушен.
    \end{enumerate}
  \item
    \marginpar{Защо $\alpha = a^pba^pb$ не е добър кандидат?}
    Разгледайте $\alpha = a^pb^pa^pb^p$.
    \begin{enumerate}[a)]
    \item
      Ако $yuv$ е в първата част на думата, то 
      $xy^0uv^0w = a^ib^ja^pb^p \not\in L_3$.
      Аналогично ако $yuv$ е във втората част на думата.
    \item
      Ако $yuv$ е в двете части на думата, то 
      Но $xy^0uv^0w = a^pb^ia^jb^p \not\in L_3$.
    \end{enumerate}    
  \end{enumerate}
\end{proof}


\begin{problem}
  Проверете дали следните езици са контекстно-свободни:
  \begin{enumerate}[a)]
  \item
    $\{a^nb^{2n}c^{3n}\ \mid\ n\in\N\}$;
  \item
    $\{a^mb^n\mid\ m \neq n\}$;
  \item
    $\{www\mid w\in \{a,b\}^\star\}$;
  \item
    $\{ww^R\mid w\in \{a,b\}^\star\}$;
  \item
    $\{a^{n^2}b^n\ \mid n \in \Nat\}$;
  \item
    $\{a^p\ \mid\ p\mbox{ е просто }\}$;
  \item
    $\{a^nb^na^nb^n\mid n\geq 0\}$;
  \item
    $\{w \in \{a,b\}^\star \mid w = w^R\}$;
  \item
    % Дефиниция на подниз
    $\{w c x\mid w,x\in \{a,b\}^\star\ \&\ w\mbox{ е подниз на }x\}$;
  \item
    $\{x_1 c x_2 c \dots c x_k\mid k\geq 2\ \&\ x_i\in\{a,b\}^\star\ \&\ (\exists i,j)[i \neq j\ \&\ x_i = x_j]\}$;
  \item
    $\{a^ib^jc^k\mid i,j,k\geq 0\ \&\ (i = j \vee j = k)\}$;
  \item
    $\{\alpha \in \{a,b,c\}^\star\mid n_a(\alpha) = n_b(\alpha) = n_c(\alpha)\}$;
  \item
    $\{a,b\}^\star \setminus \{a^nb^n\mid n\in \Nat\}$;
  \end{enumerate}
\end{problem}
% \begin{proof}
%   \begin{enumerate}
  % \item
    % За думата $w = a^pb^pc^p = xyuvw$ разгледайте различните случаи за $y$ и $v$.
  % \item[2)]
  %   Разгледайте $w = a^pb^pc^p$.
  %   \begin{enumerate}[a)]
  %   \item
  %     Знаем, че поне една от $y$ и $v$ не е празната дума.
  %     Имаме три случая за поддумите $y$ и $v$.
  %     \begin{enumerate}[i)]
  %     \item
  %       $a$ не се среща в $y$ и $v$.
  %       Тогава $xy^0vu^0w$ съдържа повече $a$ от $b$ или $c$.
  %     \item
  %       $b$ не се среща в $y$ и $v$.
  %       Ако $a$ се среща в $y$ или $v$, тогава $xy^2uv^2w$ съдържа повече $a$ от $b$
  %       Ако $c$ се среща в $y$ или $v$, тогава $xy^0uv^0w$ съдържа по-малко $c$ от $b$.
  %     \item
  %       $c$ не се среща в $y$ и $v$.
  %       Тогава $xy^2uv^2w$ съдържа повече $a$ или $b$ от $c$.
  %     \end{enumerate}      
  %   \item
  %     $y$ или $v$ е съставена от две букви.  Контекстно-свободните езици {\bf не} са затворени относно сечение и допълнение.
  %     Тук разглеждаме $xy^2uv^2w$ и съобразяваме, че редът на буквите е нарушен.
  %   \end{enumerate}
  % \item[3)]
  %   \marginpar{Защо $\alpha = a^pba^pb$ не е добър кандидат?}
  %   Разгледайте $\alpha = a^pb^pa^pb^p$.
  %   \begin{enumerate}[a)]
  %   \item
  %     Ако $yuv$ е в първата част на думата, то 
  %     $xy^0uv^0w = a^ib^ja^pb^p \not\in L_3$.
  %     Аналогично ако $yuv$ е във втората част на думата.
  %   \item
  %     Ако $yuv$ е в двете части на думата, то 
  %     Но $xy^0uv^0w = a^pb^ia^jb^p \not\in L_3$.
  %   \end{enumerate}
%   \item[10)]
%     Контекстно-свободен е. Лесно може да се напише контекстно-свободна граматика за този език.
%   \item[12)]
%     Разгледайте езика $L = L_{12} \cap a^\star b^\star c^\star$.
%   \end{enumerate}
% \end{proof}

\begin{problem}
  Проверете кои от следните езици са контекстно-свободни:
  \begin{enumerate}[a)]
  \item
    $\{a^mb^nc^k\mid m = n \vee n = k \vee m = k\}$;
  \item
    $\{a^mb^nc^k\mid m \neq n \vee n \neq k \vee m \neq k\}$;
  \item
    $\{a^mb^nc^k\mid m = n \wedge n = k \wedge m = k\}$;
  \item
    $\{w \in \{a,b,c\}^\star\mid n_a(w) \neq n_b(w) \vee n_a(w) \neq n_c(w) \vee n_b(w) \neq n_c(w)\}$.
  \end{enumerate}
\end{problem}


\section{Алгоритми}

\subsection{Нормална Форма на Чомски}

% \begin{framed}
\begin{dfn}
%[стр. 99 от \cite{sipser}]
\index{Нормална форма на Чомски}
Една контекстно-свободна граматика е в {\em нормална форма на Чоски}, ако
всяко правило е от вида
\[A \rightarrow BC\mbox{ и }A \rightarrow a,\]
като $B, C$ {\em не могат} да бъдат променливата за начало $S$.
Освен това, позволяваме правилото $S\to\varepsilon$.
\footnote{На стр. 151 в \cite{papadimitriou} дефиницията е малко по-различна.
Там дефинират $G$ да бъде в нормална форма на Чомски ако $R \subseteq V\times(V\cup\Sigma)^2$.
В този случай губим езиците $\{\varepsilon\}$ и $\{a\}$, за $a\in\Sigma$.}
\end{dfn}
% \end{framed}

\begin{thm}
  Всеки контекстно-свободен език $L$ е генериран от контекстно-свободна
  граматика в нормална форма на Чомски.
\end{thm}
\begin{proof}
  \marginpar{Броят на правилата може да се увеличи експоненциално.}
  Нека имаме контекстно-свободна граматика $G$, за която $L = L(G)$.
  Ще построим контекстно-свободна граматика $G^\prime$ в нормална форма на Чомски, $L = L(G^\prime)$.
  %[стр. 99 от \cite{sipser}]
  Следваме следната процедура:
  \begin{itemize}
  \item
    Добвяме нов начален символ $S_0$ и правило $S_0 \to S$.
  \item
    За всяка променлива $A \neq S_0$ премахваме правилата от вида $A\to\varepsilon$.
    Това правим по следния начин.
    
    Ако имаме правило от вида $R\to \beta A\gamma$, то добавяме правилото $R\to \beta\gamma$.
    Правим това за всяко срещане на променливата $A$ в дясната страна на правило.
    Например, ако имаме правило $R\to \alpha A\beta A \gamma$, то добавяме правилата $R \to \alpha\beta A\gamma$,
    $R\to \alpha\beta\gamma$ и $R\to \alpha\beta A\gamma$.
    Ако имаме $R\to A$, то добавяме правилото $R\to\varepsilon$
    само ако променливата $R$ още не е преминала през процедурата за премахване на $\varepsilon$.
  \item
    Премахваме преименуващите правила, т.е. правила от вида $A\to B$.
    Всяко правило от вида $B \to \beta$ го заменяме с $A\to \beta$,
    освен ако $A \to \beta$ е вече премахнато преименуващо правило.
  \item
    Заменяме правилата от вида $A\to u_1\dots u_n$, $n\geq 3$, $u_i \in V\cup\Sigma$, с
    правилата \[A\to u_1A_1,\ A_1\to u_2A_2,\ \dots,\ A_{n-2} \to u_{n-1}u_n.\]
    където $A_i$ са нови променливи.
    Ако $n\leq 2$, заменяме всяка буква $u_i$ с новата променлива $U_i$
    и добавяме правилото $U_i\to u_i$.
  \end{itemize}
\end{proof}

\begin{problem}
  Нека е дадена граматиката  $G = \pair{\{S,A,B,C,D,E\}, \{a,b\},S, R}$.
  \begin{enumerate}[a)]
  \item
    Намерете всички променливи, от които в $G$ се извежда празната дума.
  \item
    Принадлежи ли празната дума на $L(G)$?
  \item
    Постройте граматика $G_1$ без $\varepsilon$-правила, за която $L(G_1)=L(G)\setminus\{\varepsilon\}$.
  \end{enumerate}
  Множеството от правила $R$ на граматиката $G$ е зададено като:
  \begin{enumerate}[a)]
  \item
    $R = \{S\rightarrow D,D\rightarrow AD|b,A\rightarrow ACB|BC|a, B\rightarrow ABCA|CEC,C\rightarrow \varepsilon|CA|a, E\rightarrow \varepsilon|aEb\}$;
  \item
    $R = \{S \rightarrow aD, D\rightarrow \varepsilon|ABBA|ADD,A\rightarrow DEB|a,B\rightarrow DDD|DC|b,C\rightarrow CCE|a, E\rightarrow \varepsilon|bEa\}$;
  \item
    $R = \{ S\rightarrow D,D\rightarrow AD|b,A\rightarrow AB|BC|a, B\rightarrow AB|CC, C\rightarrow \varepsilon|CA|a, E\rightarrow a|EB\}$;
  \item
    $R = \{ S \rightarrow AD|a, D\rightarrow \varepsilon|BB|AD,A\rightarrow DB|a,B\rightarrow DD|DC|b,C\rightarrow CE|a, E\rightarrow AB|b|EA\}$;
  \item
    $R =\{S\rightarrow AS|SB|SS,B\rightarrow CA|b, C\rightarrow AA|a|BA,A\rightarrow \varepsilon|BS\}$;
  \item
    $R = \{S\rightarrow AB|AC,B\rightarrow \varepsilon |BC|b,A\rightarrow BB|CC|a,C\rightarrow CS|a\}$;
  \item
    $R = \{S\rightarrow AS|SB|SS,B\rightarrow AC|b, C\rightarrow A|a|AB,A\rightarrow \varepsilon|BS\}$;
  \item
    $R = \{S\rightarrow BA|CA,B\rightarrow \varepsilon |BC|b,A\rightarrow BB|CC|a, C\rightarrow CS|a\}$;
  \item
    $R = \{S\rightarrow AS|b,A\rightarrow AC|BC|a, B\rightarrow BC|CC,C\rightarrow \varepsilon|CA|a\}$;
  \item
    $R = \{S\rightarrow \varepsilon|BA|AS,A\rightarrow SB|a,B\rightarrow SS|SC|b,
    C\rightarrow CC|a\}$; 
  \end{enumerate}
\end{problem}

\begin{problem}
  Нека е дадена граматиката  $G = \pair{\{S,A,B,C\}, \{a,b\}, S, R}$.
  Използвайте обща конструкция, за да премахнете "дългите" правила 
  (т.е. с дължина поне 2, които не са в н.ф. на Чомски) от $ G$ като при това получите к.св. граматика $G_1$ 
  с език $L(G)=L(G_1)$, където:
  \begin{enumerate}
  \item
    $R = \{S \rightarrow \varepsilon|ab|aAba, A\rightarrow aBCb, B\rightarrow bbb, C\rightarrow aC\vert aCaC\}\rangle$;
  \item
    $R = \{S \rightarrow \epsilon|ab|baAb, A\rightarrow BaBb,B\rightarrow b,C\rightarrow AbA\vert aCCa\}$;
  \item
    $R = \{A\rightarrow BSB|a,B\rightarrow ba|BC,C\rightarrow BaSA|a|b,S\rightarrow CC|b\}$;
  \item
    $R = \{A\rightarrow BAS,B\rightarrow CB,C\rightarrow ab|ABbS,S\rightarrow CC|b\}$;
  \end{enumerate}
\end{problem}


\begin{problem}
  Използвайте обща конструкция, за да премахнете преименуващите правила от граматиката $G$ като при това запазите езика,
  където $G = \pair{\{A,B,C,S\},\{a,b\}, S, R}$ и
  \begin{enumerate}
  \item
    $R = \{A\rightarrow B|S,B\rightarrow C|BC,C\rightarrow AB|a|b,S\rightarrow B|CC|b\}$;
  \item
    $R = \{A\rightarrow B,B\rightarrow S|C|BC,C\rightarrow a|AB,S\rightarrow C|CC|b\}$;
  \item
    $R = \{A\rightarrow B|CC|a,B\rightarrow S|AB,C\rightarrow SC|b,S\rightarrow A|CC|b\}$;
  \item
    $R = \{A\rightarrow BB|b,B\rightarrow S|SS|b,C\rightarrow B|a,S\rightarrow C|AB|a\}$;
  \item
    $R = \{S\rightarrow A|a,A\rightarrow B|C|b, B\rightarrow AB, C\rightarrow CC|a\}$;
  \item
    $R = \{S\rightarrow A|B, A\rightarrow a|C|AB, B\rightarrow b|C, C\rightarrow CS|a|b\}$;
  \end{enumerate}
\end{problem}

\begin{problem}
  Намерете контекстно-свободна граматика в нормална форма на Чомски за езиците от задача 6.
  
\end{problem}


\subsection{Проблемът за принадлежност}

\begin{thm}
  Съществува полиномиален алгоритъм, който проверява дали дадена дума принадлежни на граматиката $G$.
\end{thm}
% \begin{proof}[стр. 154 от \cite{papadimitriou}]
Можем да приемем, че $G$ е граматика в нормална форма на Чомски.
Нека $\alpha = a_1a_2\dots a_n$ е дума, за която искаме да проверим дали $\alpha \in L(G)$.
\marginpar{Това е алгоритъм на Cocke-Younger-Kasami (CYK), който е пример за динамично програмиране}
\begin{algorithm}[H]
  \caption{Проверка за $\alpha \in L(G)$}
  \label{alg:belongs-to-grammar}
  \begin{algorithmic}[1]
    \STATE $n := \abs{\alpha}$
    \FORALL{$1 \leq i \leq n$}
    \STATE $V[i,i] = \{A \in V \mid A\rightarrow a_i\}$
    \ENDFOR
    \FORALL{$1 \leq i,j \leq n\ \&\ i \neq j$}
    \STATE $V[i,j] = \emptyset$
    \ENDFOR      
    \FORALL[Колко дълъг е интервала]{$s \in [1, n)$}%, за които $1 \leq s < n$}
    \FORALL[Откъде започва интервала]{$i \in [1, n-s]$}%, за които  $1 \leq i \leq n - s$}
    \FORALL[Как разделяме интервала]{$k \in [i, i + s)$}%, за които $i \leq k < i + s$}
    \IF{$\exists A\to BC \in R\ \&\ B \in V[i,k]\ \&\ C\in V[k+1,i+s]$}
    \STATE $V[i,i+s] := V[i,i+s] \cup \{A\}$
    \ENDIF
    \ENDFOR
    \ENDFOR
    \ENDFOR
    \IF{$S \in V[1,n]$}
    \RETURN \TRUE
    \ELSE
    \RETURN \FALSE
    \ENDIF
  \end{algorithmic}
\end{algorithm}

\begin{lemma}
  За всяко $1 \leq s < \abs{\alpha}$, след $s$-тата итерация на алгоритъма, за всяко $i = 1,\dots,n-s$,
  \[V[i,i+s] = \{A \in V \mid A \rightarrow^\star a_i\dots a_{i+s}\}.\]
\end{lemma}
\begin{proof}
  Индукция по $s$.
  За $s = 0$  е ясно.
\end{proof}

% Сложността на алгоритъма е $O(\abs{x}^3\abs{G})$.


\begin{problem}
  Нека е дадена граматиката $G = \pair{\{a,b\}, \{S,A,B,C\},S,R}$.
  Използвайте алгоритъма за динамично програмиране (CYK), за да проверите дали
  думата $\alpha$ принадлежи на $L(G)$, където правилата на граматиката $R$ и думата $\alpha$
  са зададени като:
  \begin{enumerate}[a)]
  \item
    $R =\{S\rightarrow a| AB|AC, C\rightarrow SB|AS,A\rightarrow a, B\rightarrow b\}$, $\alpha=aaabb$;
  \item
    $R = \{S\rightarrow BA| CA|a, C\rightarrow BS|SA,A\rightarrow a, B\rightarrow b\}$, $\alpha=bbaaa$;
  \item
    $R =\{S\rightarrow AB|BC, A\rightarrow BA|a,B\rightarrow CC|b, C\rightarrow AB|a\}$, $\alpha=baaba$;
  \item
    $R = \{S\rightarrow AB, A\rightarrow AC|a|b,B\rightarrow CB|a, C\rightarrow a\}$, $\alpha=babaa$;
  \item
    $R = \{S\rightarrow BA|SS|b, A\rightarrow SA|a,B\rightarrow BS|b\}$, $\alpha = bbbaa$;
  \item
    $R = \{S\rightarrow AB| BS|b, A\rightarrow SS|a,B\rightarrow BA|b\}$, $\alpha = babab$;
  \item
    $R = \{S\rightarrow BA| AS|a, A\rightarrow AB|a,B\rightarrow SS|b\}$, $\alpha = ababa$;
  \item
    $R = \{S\rightarrow AB|a, A\rightarrow BA|SS|a,B\rightarrow SS|b\}$, $\alpha = aabba$.
  \end{enumerate}
\end{problem}


\section{Недетерминирани стекови автомати}

\index{автомат!недетерминиран стеков}
\marginpar{На англ. Push-down automaton}
%Sipser p.102
\begin{dfn}[стр. 102 от \cite{sipser}]
  Недетерминиран краен стеков автомат е \[P = \PDA,\] където 
  \begin{itemize}
  \item
    $Q$ е крайно множество от състояния;
  \item  
    $\Sigma$ е крайна входна азбука;
  \item
    $\Gamma$ е крайна стекова азбука;
  \item
    $\# \in \Gamma$ е символ за дъно на стека;
  \item
    $s\in Q$ е начално състояние;
  \item
    $\Delta:Q\times\Sigma_\varepsilon\times\Gamma\rightarrow \Ps_{fin}(Q\times\Gamma^\star)$ 
    е {\em частична} функция на преходите;    
  \item
    $F\subseteq Q$ е множество от заключителни състояния.
  \end{itemize}
\end{dfn}

Нека $P$ е стеков автомат. Тогава
\begin{itemize}
\item
  $\Ls_F(P)$ е езика, който се разпознава от $P$ {\bfс финално състояние},
  \[\Ls_F(P) = \{w\mid (q_0,w,\#) \vdash^\star_P (q,\varepsilon,\alpha)\ \&\ q \in F\}.\]    
\item
  $\Ls_S(P)$ е езика, който се разпознава от $P$  {\bf с празен стек},
  \[\Ls_S(P) = \{w\mid (q_0,w,\#) \vdash^\star_P (q,\varepsilon,\varepsilon)\}.\]    
\end{itemize}

\begin{thm}
  Класът на езиците, които се разпознават от краен стеков автомат, съвпада с
  класа на контекстно-свободните езици.
\end{thm}

\begin{problem}
  Нека е дадена граматиката $G = \pair{\{S,A,B\},\{a,b\},S,R\}}$.
  Постройте стеков автомат $P = \PDA$, такъв че $L_S(P) = L(G)$, където правилата $R$ на граматиката $G$ са зададени като:
  \begin{enumerate} 
    % За едно тези двете да се даде пример как става 
  \item
    $R = \{S\rightarrow ASB\vert \varepsilon, A\rightarrow aAa\vert a, B\rightarrow bBb\vert b\}$;
  \item
    $R = \{S\rightarrow ASB\vert \varepsilon, A\rightarrow aA\vert a, B\rightarrow Bb\vert b\}$;
  \item
    $R =\{S\rightarrow SA|\varepsilon,A\rightarrow BSa|B, B\rightarrow b|BS|ab\}$;
  \item
    $R = \{S\rightarrow AS|\varepsilon,A\rightarrow SaBB|A, B\rightarrow b|BBbS|AA\}$;
  % \item
  %   $\Gamma=\langle\{S,A,B,C,D,E\},\{a,b\},S,$\\
  %   $\{S \rightarrow aD, D\rightarrow ab|ABBA|ADD,A\rightarrow DEB|a,B\rightarrow DDD|DC|b,C\rightarrow CCE|a, E\rightarrow ba|bEa\}\rangle$;
  % \item
  %   $\Gamma=\langle\{S,A,B,C,D,E\},\{a,b\},S,$\\
  %   $\{S\rightarrow D,D\rightarrow AD|b,A\rightarrow ACB|BC|a, B\rightarrow ABCA|CEC, C\rightarrow \varepsilon|CA|a, E\rightarrow ab|aEb\}\rangle$;
  % \item
  %   $\Gamma=\langle\{S,A,B,C,D,E\},\{a,b\},S,$\\
  %   $\{S \rightarrow aD, D\rightarrow \varepsilon|ABBA|ADD,A\rightarrow DEB|a,B\rightarrow DDD|DC|b,C\rightarrow CCE|a, E\rightarrow \varepsilon|bEa\}\rangle$;
  % \item
  %   $\Gamma=\langle\{S,A,B,C,D,E\},\{a,b\},S,$\\
  %   $\{S\rightarrow D,D\rightarrow AD|b,A\rightarrow ACB|BC|a, B\rightarrow ABCA|CEC, C\rightarrow \varepsilon|CA|a, E\rightarrow \varepsilon|aEb\}\rangle$;

  % \item
  %   $\Gamma=\langle\{S,A,B,C,D,E\},\{a,b\},S,$\\
  %   $\{S\rightarrow DD,D\rightarrow DDA|b,A\rightarrow CAB|a, B\rightarrow BCA|CCE, C\rightarrow \varepsilon|CA|a, E\rightarrow \varepsilon|EaE\}\rangle$;
  % \item
  %   $\Gamma=\langle\{S,A,B,C,D,E\},\{a,b\},S,$\\
  %   $\{S\rightarrow DD,D\rightarrow DA|b,A\rightarrow CAB|a, B\rightarrow BCA|CCE, C\rightarrow \varepsilon|CA|a, E\rightarrow \varepsilon|EaE\}\rangle$;
  \end{enumerate}
\end{problem}

\section{Въпроси}
Вярно ли е, че:
\begin{itemize}
\item
  \marginpar{Да} 
  ако $L$ е контекстно-свободен език, то езикът $L \cap \{a^{2n}b^{2k}\mid n,k\in\Nat\}$ е контекстно-свободен ?
\item
  \marginpar{Да}
  ако $L$ е безкраен контекстно-свободен език, то съществува безкрайна редица от регулярни езици $L_1,L_2,\dots$,
  за които $L = \bigcup_{i\in\Nat}L_i$ ?
\item
  \marginpar{Не}
  за всяка безкрайна редица от регулярни езици $L_1,L_2,\dots$, то 
  езикът $L = \bigcup_{i\in\Nat}L_i$ е контекстно-свободен ?
\item
  за всеки регулярен език $R$ и всеки контекстно-свободен език $L$, то $L \cap R$ е контекстно-свободен ?
\item
  за всеки регулярен език $R$ и всеки контекстно-свободен език $L$, то $L \cup R$ е контекстно-свободен ?
\item
  за всеки регулярен език $R$ и всеки контекстно-свободен език $L$, то $L \setminus R$ е контекстно-свободен ?
\item
  за всеки регулярен език $R$ и всеки контекстно-свободен език $L$, то $R \setminus L$ е контекстно-свободен ?
\item
  съществува регулярен език $R$ и контекстно-свободен език $L$, за които $L \cap R$ не е контекстно-свободен ?
\item
  съществува регулярен език $R$ и нерегулярен, но контекстно-свободен език $L$, за които $L \cap R$ е регулярен ?
\item
  за всеки два нерегулярни, но контекстно-свободни езика $L_1,L_2$, то $L_1\cup L_2$ е регулярен ?
\item
  съществуват два нерегулярни, но контекстно-свободни езика $L_1,L_2$, за които $L_1\setminus L_2$ е регулярен ?
\item
  съществуват два нерегулярни, но контекстно-свободни езика $L_1,L_2$, за които $L_1\cap L_2$ е регулярен ?
\item
  съществуват два нерегулярни, но контекстно-свободни езика $L_1,L_2$, за които $L_1\cup L_2$ е регулярен ?
\item
  съществува регулярен език $R$, който може да се представи като $R = L_1 \cup L_2$, където
  $L_1 \cap L_2 = \emptyset$, $L_1,L_2$ са нерегулярни, но контекстно-свободни ?
\item
  езикът $\{a,b\}^\star \setminus \{a^nb^n \mid n\in\Nat\}$ е регулярен ?
\item
  езикът $\{a,b\}^\star \setminus \{a^nb^{2k+1} \mid n,k\in\Nat\}$ е регулярен ?
\item
  езикът $\{a,b\}^\star \setminus \{a^nb^{k} \mid n > k\}$ е регулярен ?
\item
  езикът $\{a,b\}^\star \setminus \{a^nbba^{n} \mid n \in \Nat\}$ е регулярен ?
\item
  езикът $\{a,b\}^\star \setminus \{a^nb^n \mid n\in\Nat\}$ е контекстно-свободен ?
\item
  езикът $\{a,b,c\}^\star \setminus \{a^nb^mc^k \mid m < n\ \&\ m < k\}$ е контекстно-свободен ?
\end{itemize}

Нека е дадена контекстно-свободната граматика $G$ с правила \[S\rightarrow a\vert AB \vert AC, A \rightarrow a, B\rightarrow b, C\rightarrow SB.\]
Вярно ли е, че ако приложим CYK алгоритъма върху думата $\alpha$, където
\begin{itemize}
\item 
  $\alpha = aabb$, то $N[1,1] = \{S\}$.
\item 
  $\alpha = aabb$, то $N[3,3] = \{B\}$.
\item 
  $\alpha = aabb$, то $N[1,4] = \{\}$.
\item
  $\alpha = baab$, то $N[2,4] = \{\}$.
\item
  $\alpha = baab$, то $N[1,3] = \{\}$.
\end{itemize}



%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "discrete-math"
%%% End: 
